# Example: Complete Release Workflow
# This workflow demonstrates how simple it is to use Relicta
# No Go, Make, or build tools required!
#
# For your own projects, use: relicta-tech/relicta-action@v1

name: Example Release

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Run in dry-run mode (no actual release)'
        type: boolean
        default: true
      command:
        description: 'Command to run'
        type: choice
        options:
          - full
          - plan
          - bump
          - notes
        default: plan

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Create test git history for demo purposes
      - name: Setup test commits
        if: inputs.dry_run
        run: |
          git config user.name "Test Bot"
          git config user.email "test@example.com"

          # Create a test tag if none exists
          if ! git describe --tags --abbrev=0 2>/dev/null; then
            git tag v0.0.0 $(git rev-list --max-parents=0 HEAD)
          fi

      # Use local action for testing (use @v1 in your own workflows)
      - name: Release with Relicta
        id: release
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          command: ${{ inputs.command }}
          dry-run: ${{ inputs.dry_run }}

      - name: Show results
        if: always()
        run: |
          echo "Command: ${{ inputs.command }}"
          echo "Dry run: ${{ inputs.dry_run }}"
          if [ -n "${{ steps.release.outputs.version }}" ]; then
            echo "Version: ${{ steps.release.outputs.version }}"
          fi
          if [ -n "${{ steps.release.outputs.release-url }}" ]; then
            echo "Release URL: ${{ steps.release.outputs.release-url }}"
          fi
